# 前端监控方案
整体运转链路大概如下：
应用程序收集数据 --> 数据上报 --> 中台转发 --> ELK/... --> GUI

## 收集、上报数据

### 收集方式
为了通用性与易用性，采用cdn or npm形式提供一个含有（错误收集、错误上报、性能监控、用户行为跟踪）的sdk。
1. 自动收集（通过sdk注入，进行无艮埋点）
2. 手动上报（业务侧使用sdk-hook上报业务数据）

### 数据内容
**指标数据**
1. PV/UV
2. 用户在每一个页面的停留时间
3. 用户通过什么入口来访问该网页
4. 用户在相应的页面中触发的行为
5. ...
**异常监控**
1. javascript运行异常
   a: 接口错误
   b: 代码错误
   c: unhandledrejection
2. 静态资源缺失
   1. css
   2. img
   3. ...

**性能监控**
1. 首屏加载时间
2. 白屏时间
3. http等请求的响应时间
4. 静态资源整体下载时间
5. 页面渲染时间
6. 页面交互动画完成时间
7. 。。。

## 接收、转发数据

**node服务**

## GUI监控平台

## 现有资源
**@gaoding/gd-tracker**
web埋点sdk。基于dom事件进行用户行为收集。
优点：内置vue指令，抽象出标准数据格式进行上报
缺点：与业务有强耦合度，没有通用性
**@gaoding/wind-tracker**
小程序埋点。
**sentry**
优点：对js代码执行异常有较好堆栈追踪策略
缺点：快速排查错误的其他信息没有收集，（设备信息、运行环境、用户信息、操作流程、情景复现）

## 我们需要做的
思考：如何有效、快速追踪线上问题。
结论：问题发生时，需要提供为什么发生（发生的过程，包含环境、条件、流程），以及发生之后影响了什么（用户、视图、逻辑）
### 有效
**代码静态检查**
1. codereview
2. eslint + husky
3. 静态代码分析工具
4. 程序指标监控
**提供错误场景**
1. sourceMap 复现错误代码堆栈
2. 异常操作行为追踪
   a: router
   b: data
   c: http
   e: dom
   f: event
3. 利用操作场景 + 代码资源进行场景重现
### 快速
**报警通知**
1. 钉钉
2. 邮件

## 场景复现功能
1. 所处环境、设备
2. 当时的页面数据、dom结构
3. 